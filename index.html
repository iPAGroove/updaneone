<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>URSA IPA ‚Äî PWA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
  
  <!-- –í–∞–∂–Ω–æ –¥–ª—è iOS standalone —Ä–µ–∂–∏–º–∞ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <!-- –°—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="./starts/instructions.css?v=10">
</head>

<body>
  <div class="wrap">
    <h1 class="title">URSA IPA</h1>

    <div class="card">
      <p class="text">
        –ß—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω.
      </p>

      <img src="./starts/pwa-guide.png" class="guide-img" alt="Guide">

      <p class="steps">
        üìå Safari ‚Üí –ü–æ–¥–µ–ª–∏—Ç—å—Å—è ‚Üí <br>
        ¬´–ù–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω¬ª
      </p>

      <button id="continueBtn" class="btn" disabled>
        –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∂–∏–º–∞‚Ä¶
      </button>
    </div>
  </div>

<script>
// ===== SUPER-ULTRA-RELIABLE PWA DETECTION =====

function isPWAMode() {
  // –°—Ç–∞—Ä—ã–π iOS —Å–ø–æ—Å–æ–±
  if (window.navigator.standalone === true) return true;

  // –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ–∂–∏–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  const modes = ["standalone", "fullscreen", "minimal-ui"];
  for (let mode of modes) {
    if (window.matchMedia("(display-mode: " + mode + ")").matches) {
      return true;
    }
  }

  return false;
}

function redirectToPWA() {
  console.log("[URSA] Checking PWA mode...");
  if (isPWAMode()) {
    console.log("[URSA] PWA detected ‚Üí redirecting to home.html");
    window.location.replace("./home.html?v=10");
    return true;
  }
  return false;
}

document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("continueBtn");
  btn.textContent = "–î–æ–±–∞–≤—å—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω";
  btn.disabled = true;

  // iOS –≤–∫–ª—é—á–∞–µ—Ç standalone —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π ‚áí –¥–µ–ª–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–æ–∫
  let attempts = 0;
  const interval = setInterval(() => {
    attempts++;
    if (redirectToPWA() || attempts > 15) {
      clearInterval(interval);
    }
  }, 200);
});
</script>

</body>
</html>
