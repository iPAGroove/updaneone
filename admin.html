<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>URSA Admin Panel — v5 (Classic IPA View)</title>
  <meta name="theme-color" content="#0d1117" />
  <meta name="color-scheme" content="dark" />

    <link rel="stylesheet" href="assets/css/admin.css?v=5" />
</head>

<body>
<noscript>
  <div style="padding:14px;background:#ff5252;color:#000;font-weight:600;text-align:center">
    Для работы панели администрирования требуется включённый JavaScript.
  </div>
</noscript>

<div id="root" class="admin-root">
    <section id="admin-auth" class="auth-screen" role="dialog" aria-labelledby="auth-title" aria-modal="true">
    <div class="auth-card" role="document">
      <h1 id="auth-title" class="brand-xl">URSA <span>ADMIN</span></h1>
      <p class="muted">Вход только для администраторов. Используйте Google-аккаунт.</p>
      <button id="auth-login-btn" class="btn btn-accent" aria-label="Войти через Google">Войти через Google</button>
      <p id="auth-error" class="error-text" aria-live="polite"></p>
    </div>
  </section>

    <div id="admin-app" class="app-shell" style="display:none">
        <aside class="sidebar" role="navigation" aria-label="Основная навигация">
      <div class="sidebar-brand">
        <div class="logo-dot" aria-hidden="true"></div>
        <div class="brand">URSA <span>ADMIN</span></div>
      </div>

      <nav class="side-nav">
        <button class="side-link" data-view="dashboard" aria-controls="view-dashboard" aria-selected="false">
          <span class="ic" aria-hidden="true">📊</span>
          Дашборд
        </button>
        <button class="side-link active" data-view="apps" aria-controls="view-apps" aria-selected="true">
          <span class="ic" aria-hidden="true">📱</span>
          Приложения
        </button>
        <button class="side-link" data-view="users" aria-controls="view-users" aria-selected="false">
          <span class="ic" aria-hidden="true">👥</span>
          Пользователи
        </button>
        <button class="side-link" data-view="orders" aria-controls="view-orders" aria-selected="false">
          <span class="ic" aria-hidden="true">💸</span>
          VIP Заявки
          <span id="orders-counter" class="pill" aria-label="Активных VIP заявок">0</span>
        </button>
        <button class="side-link" data-view="cert-orders" aria-controls="view-cert-orders" aria-selected="false">
          <span class="ic" aria-hidden="true">🔐</span>
          Cert Заявки
          <span id="cert-orders-counter" class="pill" aria-label="Активных заявок на сертификаты">0</span>
        </button>
      </nav>

      <div class="side-bottom">
        <button id="admin-logout-btn" class="side-link danger" aria-label="Выйти из админ-панели">↩ Выход</button>
      </div>
    </aside>

        <main class="main" role="main">
            <header class="topbar" role="banner">
        <div class="crumbs" id="topbar-title">📱 Каталог приложений</div>
        <div class="top-actions">
          <div class="kbd-hint" title="Нажмите / для поиска">/</div>
        </div>
      </header>

            <div class="views">
                <section id="view-dashboard" class="view" tabindex="0" aria-labelledby="dashboard-title">
          <h2 id="dashboard-title" class="sr-only">Общая статистика</h2>
          <div class="stats-grid">
            <article class="stat-card" role="status" aria-live="polite"><div class="stat-label">Всего приложений</div><div id="stat-apps" class="stat-value">0</div></article>
            <article class="stat-card" role="status" aria-live="polite"><div class="stat-label">VIP-пользователей</div><div id="stat-vip" class="stat-value">0</div></article>
            <article class="stat-card" role="status" aria-live="polite"><div class="stat-label">Активные заказы</div><div id="stat-orders" class="stat-value">0</div></article>
            <article class="stat-card" role="status" aria-live="polite"><div class="stat-label">UDID в базе</div><div id="stat-signers" class="stat-value">0</div></article>
          </div>
        </section>

                <section id="view-apps" class="view active" tabindex="0" aria-labelledby="apps-title">
          <h2 id="apps-title" class="sr-only">Каталог приложений</h2>
          
          <div class="admin-actions">
            <button id="add-app-btn" class="btn btn-accent">+ Добавить IPA</button>
            <input id="app-search" class="input" type="search" placeholder="Поиск по имени, bundleId, тегам…" inputmode="search" />
          </div>
          
          <div id="apps-grid" class="cards" aria-busy="true" aria-live="polite">
                      </div>
          <div id="apps-skeleton" class="cards-skeleton">
                      </div>
        </section>

                <section id="view-users" class="view" tabindex="0" aria-labelledby="users-title">
          <div class="view-head">
            <h2 id="users-title">Пользователи</h2>
          </div>

          <div class="admin-actions">
            <input id="user-search" class="input" type="search" placeholder="Поиск по Email, имени…" inputmode="search" />
          </div>

          <div class="table-wrap">
            <table class="user-table" id="users-table">
              <thead>
                <tr><th>Email</th><th>Имя</th><th>UID</th><th>Статус</th><th>Действие</th></tr>
              </thead>
              <tbody id="user-list"></tbody>
            </table>
          </div>
          <div id="users-skeleton" class="list-skeleton"></div>
        </section>

                <section id="view-orders" class="view" tabindex="0" aria-labelledby="orders-title">
          <div class="view-head"><h2 id="orders-title">VIP Заявки</h2><div class="view-actions">
            <select id="orders-status" class="select small"><option value="all">Все</option><option value="pending">Ожидает</option><option value="processing">В работе</option><option value="completed">Завершено</option><option value="canceled">Отменено</option></select>
          </div></div>
          <div class="filters"><input id="order-search" class="input" type="search" placeholder="Поиск по UID/Order ID…" inputmode="search" /></div>
          <ul id="orders-list" class="orders-list" aria-live="polite"></ul>
          <div id="orders-skeleton" class="list-skeleton"></div>
        </section>
        
                <section id="view-cert-orders" class="view" tabindex="0" aria-labelledby="cert-orders-title">
          <div class="view-head"><h2 id="cert-orders-title">🔐 Заявки на Сертификаты</h2><div class="view-actions">
            <select id="cert-orders-status" class="select small"><option value="all">Все</option><option value="pending">Ожидает</option><option value="processing">В работе</option><option value="completed">Завершено</option><option value="canceled">Отменено</option></select>
          </div></div>
          <div class="filters"><input id="cert-order-search" class="input" type="search" placeholder="Поиск по UID/Order ID…" inputmode="search" /></div>
          <ul id="cert-orders-list" class="orders-list" aria-live="polite"></ul>
          <div id="cert-orders-skeleton" class="list-skeleton"></div>
        </section>
        
      </div>
    </main>

        <aside id="chat-panel" class="chat-panel" aria-labelledby="chat-title" aria-hidden="true">
      <header class="chat-head">
        <div class="chat-title">
          <h3 id="chat-title">Заявка: <span id="chat-order-id">—</span></h3>
          <div class="sub" id="chat-order-meta">Тип/Метод: — • UID: —</div>
        </div>
        <button id="chat-close" class="icon-btn" aria-label="Закрыть чат">✕</button>
      </header>

      <div class="chat-toolbar">
        <select id="order-status-select" class="select small">
          <option value="pending">Ожидает</option>
          <option value="processing">В работе</option>
          <option value="completed">Завершено</option>
          <option value="canceled">Отменено</option>
        </select>
        <button id="set-vip-btn" class="btn btn-accent small">✅ Выдать VIP</button>
      </div>

      <div id="admin-chat-area" class="chat-scroll" aria-live="polite"></div>

      <form id="chat-form" class="chat-input" autocomplete="off">
        <label class="sr-only" for="admin-chat-input">Сообщение</label>
        <input id="admin-chat-input" type="text" class="input" placeholder="Ответить пользователю…" />
        <button id="admin-chat-send" class="btn btn-ghost" type="submit" aria-label="Отправить">➤</button>
      </form>
    </aside>
  </div>
</div>

<div id="app-modal" class="modal" aria-hidden="true" aria-labelledby="app-modal-title" role="dialog">
  <div class="backdrop" data-close></div>
  <div class="modal-card">
    <header class="modal-head">
      <strong id="modal-title">Добавить IPA</strong>
      <button class="close" data-close>✕</button>
    </header>
    <form id="ipa-form" class="modal-body">
      <input type="hidden" name="docId" id="app-id" />
      <fieldset>
        <legend>Основное</legend>
        <div class="field-grid">
          <label>Name <input type="text" name="name" required></label>
          <label>Bundle ID <input type="text" name="bundleId" required></label>
          <label>Version <input type="text" name="version" required></label>
          <label>Minimal iOS <input type="text" name="minIOS"></label>
          <label>Size (MB) <input type="number" name="sizeMB"></label>
        </div>
      </fieldset>
      <fieldset>
        <legend>Медиа</legend>
        <label>Icon URL
          <input type="url" name="iconUrl" id="iconUrl">
          <img id="icon-preview" class="icon-preview" style="display:none;">
        </label>
        <label>Download URL <input type="url" name="downloadUrl" required></label>
      </fieldset>
      <fieldset>
        <legend>Функции мода / Hack Features</legend>
        <label>Features (RU) <textarea name="features_ru" placeholder="через запятую"></textarea></label>
        <label>Features (EN) <textarea name="features_en" placeholder="comma separated"></textarea></label>
      </fieldset>
      <fieldset>
        <legend>Категория</legend>
        <div class="tag-buttons">
          <button type="button" class="tag-btn" data-tag="games">Games</button>
          <button type="button" class="tag-btn" data-tag="apps">Apps</button>
        </div>
        <input type="hidden" name="tag" />
      </fieldset>
      <fieldset>
        <legend>VIP доступ</legend>
        <label class="checkbox-line">
          <input type="checkbox" name="vipOnly" id="vipOnly">
          <span>Доступ только для VIP</span>
        </label>
      </fieldset>
      <div class="modal-actions">
        <button type="submit" class="btn btn-accent">💾 Сохранить</button>
        <button type="button" class="btn btn-danger" id="app-delete-btn" style="display:none;">🗑 Удалить</button>
      </div>
    </form>
  </div>
</div>

<div id="user-modal" class="modal" aria-hidden="true" aria-labelledby="user-modal-title" role="dialog">
  <div class="backdrop" data-close></div>
  <div class="modal-card small">
    <header class="modal-head">
      <strong id="user-modal-title">Редактировать пользователя</strong>
      <button class="close" data-close>✕</button>
    </header>
    <div class="modal-body">
      <p><b>Email:</b> <span id="edit-user-email"></span></p>
      <p><b>Имя:</b> <span id="edit-user-name"></span></p>
      <label>Статус:
        <select id="edit-user-status">
          <option value="free">Free</option>
          <option value="vip">VIP</option>
        </select>
      </label>
      
      <div class="modal-actions-user">
        <button id="save-user-status" class="btn btn-accent">💾 Сохранить (Постоянно)</button>
        <button type="button" id="save-user-vip-31" class="btn vip-btn">⭐ VIP на 31 день</button>
      </div>
    </div>
  </div>
</div>
<div class="sr-only" aria-hidden="true">.</div>

<script type="module" src="assets/js/app.js?v=1"></script>
<script type="module" src="assets/js/admin.js?v=5"></script>
</body>
</html>
